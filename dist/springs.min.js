var $event=$.event,$specialEvent=$event.special,drag;drag=$specialEvent.drag={settings:{related:0,distance:10,click:!1,cursor:!0},handlers:{dragstart:null,drag:null,dragend:null},dragging:!1,key:"uxdragdata",touches:0,setup:function(a){var b=$(this);if(!b.data(drag.key)){var c=$.extend(drag.settings,a);b.data(drag.key,c),c.cursor&&b.css("cursor","pointer"),b.on("touchstart.drag mousedown.drag",c,drag.starter)}},teardown:function(){$(this).data(drag.key,""),$this.css("cursor",""),this.off("touchstart.drag mousedown.drag"),drag.setTextSelectability(!0)},add:function(a){var b=$(this).data(drag.key);b.related+=1,drag.handlers[a.type]=a.handler,$.extend(b,a.data||{})},remove:function(){$.data(this,drag.key).related-=1},_default:function(){},starter:function(a){if(!drag.touches){drag.touches="touchstart"==a.type?1:0,drag.setTextSelectability(!1);var b=$(this).data(drag.key);drag.check.anyFalse(!drag.touches&&1!=a.which,b.handle&&$(a.target).closest(b.handle,a.currentTarget).length<1)&&(b.target=a.target,b.pageX=a.originalEvent.pageX,b.pageY=a.originalEvent.pageY,drag.touches?$(this).on("touchmove.drag touchend.drag",b,drag.handler):$(document).on("mousemove.drag mouseup.drag",b,drag.handler))}},handler:function(a){var b=a.data;if(b)switch(a.type){case"touchmove":case"mousemove":a.preventDefault(),drag.configureEvent(a,b),!drag.dragging&&a.distance>b.distance?(drag.dragging=!0,drag.dispatchEvent("dragstart",a,this)):drag.dragging&&drag.dispatchEvent("drag",a,this);break;case"touchend":case"mouseup":drag.configureEvent(a,b),drag.dragging=!1,drag.dispatchEvent("dragend",a,this),$(document).off("mousemove.drag mouseup.drag"),drag.touches=0}},configureEvent:function(a,b){a.deltaX=a.originalEvent.pageX-b.pageX,a.deltaY=a.originalEvent.pageY-b.pageY,a.distance=Math.sqrt(Math.pow(Math.abs(a.deltaX),2)+Math.pow(Math.abs(a.deltaY),2))},dispatchEvent:function(a,b,c){drag.handlers[a]&&(b.type=a,b.originalEvent=null,drag.handlers[a].apply(c,[b]))},setTextSelectability:function(a){a?($(document).off("selectstart").css("MozUserSelect",""),document.unselectable=!1):($(document).on("selectstart",function(){return!1}).css("MozUserSelect","false"),document.unselectable=!0)},check:{anyFalse:function(){for(var a=0;a<arguments.length;a++)if(!arguments[a])return!0;return!1},allFalse:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])return!1;return!0}}},$specialEvent.dragstart=$specialEvent.dragend=drag;