<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="message-bubble.css">
    <script src="../../../bower_components/jquery/dist/jquery.js"></script>
    <script src="message-bubble.js"></script>
    <script src="../../springs.js"></script>
</head>

<div class="message-bubble-container">
</div>

<script type="text/javascript">
$(document).ready(function() {

    var mc = new MessageController();
    mc.timestamp();
    mc.add("Sample message 1");
    var $m2 = mc.add("Sample message 2");
    var $m3 = mc.add("Sample message 3", { inReplyTo: $m2, artificialDate: (new Date()).getTime() + 80000000 });
    mc.add("Sample message 4", { inReplyTo: $m3, artificialDate: (new Date()).getTime() + 2*80000000 });
    mc.add("Sample message 5", { reply: true, artificialDate: (new Date()).getTime() + 2*83000000 });

    var $container = $(".message-bubble-container"),
        maxMovement = $(".message-bubble-timestamp").first().outerWidth();
    $container.on("dragstart", function(e) {
        $(".message-bubble").removeClass("return");
    });

    $container.on("dragend", function(e) {
        $(".message-bubble").addClass("return").css("transform", "translateX(0)");
        $(".message-bubble-timestamp").css("opacity", 0);
        var outerWidth = $container.outerWidth() - parseFloat($container.css("padding-left")) - parseFloat($container.css("padding-right"));
        $(".message-bubble.reply").each(function() {
            var $this = $(this);
            $this.find(".message-bubble-timestamp").css("transform", "translate(" + (outerWidth - $this.outerWidth()) + "px, -50%)");
        });
    });

    $container.on("drag", function(e) {
        $(".message-bubble:not(.reply)").css("transform", "translateX(" + Math.max(e.deltaX, -maxMovement) + "px)");
        $(".message-bubble-timestamp").css("opacity", Math.max(0, e.deltaX/-maxMovement));
        var $container = $(".message-bubble-container"),
            outerWidth = $container.outerWidth() - parseFloat($container.css("padding-left")) - parseFloat($container.css("padding-right"));
        $(".message-bubble.reply").each(function() {
            var $this = $(this);
            $this.find(".message-bubble-timestamp").css("transform", "translate(" + (outerWidth - $this.outerWidth() - Math.min(maxMovement, -e.deltaX)) + "px, -50%)");
        });
    });
});
</script>