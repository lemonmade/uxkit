<html>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <link href='css/style.css' rel='stylesheet'>
    <script src='js/jquery.js' type='text/javascript'></script>
    <script src='js/script.js' type='text/javascript'></script>
    <title>Message Bubble - uxkit</title>
  </head>
  <body>
    <header class='page-header'>
      <h1>
        <span class='logo ux'>ux</span><span class='logo kit'>kit</span></h1>
    </header>
    <nav class='sidebar'>
      <ul>
        <li class='main-page-nav-item'>
          <a href='/'>Home</a>
        </li>
        <li>
          Components
          <ul class='component-sidebar'>
            <li>
              Message Bubble
            </li>
            <li>
              <a href='/notification-mac'>Notification Mac</a>
            </li>
            <li>
              <a href='/segmented-control'>Segmented Control</a>
            </li>
            <li>
              <a href='/toggle-switch'>Toggle Switch</a>
            </li>
          </ul>
        </li>
        <li>
          Behaviors
          <ul class='behavior-sidebar'>
          </ul>
        </li>
      </ul>
    </nav>
    <div class='components'>
      <h2>Message Bubble</h2>
      <div class='example-components'>
        <h3>Example</h3>
        <div class='example-component'>
          <div class='message-bubble-container'>
            <div class='message-bubble'>
              <div class='message-bubble-inner'>
                Here is the message
                <svg class='message-bubble-whale-tail' enable-background='new 0 0 116.42 97.35' height='119px' style='display: none' version='1.1' viewbox='0 0 116 119' width='116px' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'>
                  <path d='M67.39,79.03 C84.24,104.95 116.42,115.32 116.42,115.32 C116.42,115.32 73.88,124.39 46.66,115.32 C19.44,106.24 0,79.03 0,79.03 L0,-0.227279902 L51.8400002,-0.227279902 L51.84,22 C51.84,22 50.54,53.1 67.39,79.03 Z' fill='#AOAOAO'></path>
                </svg>
              </div>
            </div>
            <div class='message-bubble reply'>
              <div class='message-bubble-inner'>
                Here is the reply
                <svg class='message-bubble-whale-tail' enable-background='new 0 0 116.42 97.35' height='119px' style='display: none' version='1.1' viewbox='0 0 116 119' width='116px' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'>
                  <path d='M67.39,79.03 C84.24,104.95 116.42,115.32 116.42,115.32 C116.42,115.32 73.88,124.39 46.66,115.32 C19.44,106.24 0,79.03 0,79.03 L0,-0.227279902 L51.8400002,-0.227279902 L51.84,22 C51.84,22 50.54,53.1 67.39,79.03 Z' fill='#AOAOAO'></path>
                </svg>
              </div>
            </div>
          </div>
        </div>
        <h3>Fallback Without CSS</h3>
        <div class='example-component no-css'>
          <div class='message-bubble-container'>
            <div class='message-bubble'>
              <div class='message-bubble-inner'>
                Here is the message
                <svg class='message-bubble-whale-tail' enable-background='new 0 0 116.42 97.35' height='119px' style='display: none' version='1.1' viewbox='0 0 116 119' width='116px' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'>
                  <path d='M67.39,79.03 C84.24,104.95 116.42,115.32 116.42,115.32 C116.42,115.32 73.88,124.39 46.66,115.32 C19.44,106.24 0,79.03 0,79.03 L0,-0.227279902 L51.8400002,-0.227279902 L51.84,22 C51.84,22 50.54,53.1 67.39,79.03 Z' fill='#AOAOAO'></path>
                </svg>
              </div>
            </div>
            <div class='message-bubble reply'>
              <div class='message-bubble-inner'>
                Here is the reply
                <svg class='message-bubble-whale-tail' enable-background='new 0 0 116.42 97.35' height='119px' style='display: none' version='1.1' viewbox='0 0 116 119' width='116px' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'>
                  <path d='M67.39,79.03 C84.24,104.95 116.42,115.32 116.42,115.32 C116.42,115.32 73.88,124.39 46.66,115.32 C19.44,106.24 0,79.03 0,79.03 L0,-0.227279902 L51.8400002,-0.227279902 L51.84,22 C51.84,22 50.54,53.1 67.39,79.03 Z' fill='#AOAOAO'></path>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Write all relevant documentation here. -->
      <div class='component-actions'>
        <button class='component-action' data-component-detail='source-code'>Source Code</button>
        <button class='component-action' data-component-detail='api'>API</button>
      </div>
      <div class='source-code'>
        <div class='source-code-language'>
          <h3>HTML</h3>
          <div class='source-code-html'>
            <pre><code class="highlight"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'message-bubble-container'</span><span class="nt">&gt;</span>&#x000A;  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'message-bubble'</span><span class="nt">&gt;</span>&#x000A;    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'message-bubble-inner'</span><span class="nt">&gt;</span>&#x000A;      Here is the message&#x000A;      <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">'message-bubble-whale-tail'</span> <span class="na">enable-background=</span><span class="s">'new 0 0 116.42 97.35'</span> <span class="na">height=</span><span class="s">'119px'</span> <span class="na">style=</span><span class="s">'display: none'</span> <span class="na">version=</span><span class="s">'1.1'</span> <span class="na">viewbox=</span><span class="s">'0 0 116 119'</span> <span class="na">width=</span><span class="s">'116px'</span> <span class="na">xml:space=</span><span class="s">'preserve'</span> <span class="na">xmlns=</span><span class="s">'http://www.w3.org/2000/svg'</span><span class="nt">&gt;</span>&#x000A;        <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">'M67.39,79.03 C84.24,104.95 116.42,115.32 116.42,115.32 C116.42,115.32 73.88,124.39 46.66,115.32 C19.44,106.24 0,79.03 0,79.03 L0,-0.227279902 L51.8400002,-0.227279902 L51.84,22 C51.84,22 50.54,53.1 67.39,79.03 Z'</span> <span class="na">fill=</span><span class="s">'#AOAOAO'</span><span class="nt">&gt;&lt;/path&gt;</span>&#x000A;      <span class="nt">&lt;/svg&gt;</span>&#x000A;    <span class="nt">&lt;/div&gt;</span>&#x000A;  <span class="nt">&lt;/div&gt;</span>&#x000A;  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'message-bubble reply'</span><span class="nt">&gt;</span>&#x000A;    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'message-bubble-inner'</span><span class="nt">&gt;</span>&#x000A;      Here is the reply&#x000A;      <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">'message-bubble-whale-tail'</span> <span class="na">enable-background=</span><span class="s">'new 0 0 116.42 97.35'</span> <span class="na">height=</span><span class="s">'119px'</span> <span class="na">style=</span><span class="s">'display: none'</span> <span class="na">version=</span><span class="s">'1.1'</span> <span class="na">viewbox=</span><span class="s">'0 0 116 119'</span> <span class="na">width=</span><span class="s">'116px'</span> <span class="na">xml:space=</span><span class="s">'preserve'</span> <span class="na">xmlns=</span><span class="s">'http://www.w3.org/2000/svg'</span><span class="nt">&gt;</span>&#x000A;        <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">'M67.39,79.03 C84.24,104.95 116.42,115.32 116.42,115.32 C116.42,115.32 73.88,124.39 46.66,115.32 C19.44,106.24 0,79.03 0,79.03 L0,-0.227279902 L51.8400002,-0.227279902 L51.84,22 C51.84,22 50.54,53.1 67.39,79.03 Z'</span> <span class="na">fill=</span><span class="s">'#AOAOAO'</span><span class="nt">&gt;&lt;/path&gt;</span>&#x000A;      <span class="nt">&lt;/svg&gt;</span>&#x000A;    <span class="nt">&lt;/div&gt;</span>&#x000A;  <span class="nt">&lt;/div&gt;</span>&#x000A;<span class="nt">&lt;/div&gt;</span>&#x000A;</code></pre>
          </div>
        </div>
        <div class='source-code-language'>
          <h3>CSS</h3>
          <div class='source-code-css'>
            <pre><code class="highlight"><span class="nc">.message-bubble-container</span><span class="nd">:after</span><span class="o">,</span> <span class="nc">.message-bubble-date-section</span><span class="nd">:after</span> <span class="p">{</span>&#x000A;  <span class="nl">content</span><span class="p">:</span> <span class="s2">''</span><span class="p">;</span>&#x000A;  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>&#x000A;  <span class="nl">clear</span><span class="p">:</span> <span class="nb">both</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="nc">.message-bubble-container</span> <span class="p">{</span>&#x000A;  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>&#x000A;  <span class="nl">padding</span><span class="p">:</span> <span class="m">1em</span><span class="p">;</span>&#x000A;  <span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="nc">.message-bubble</span><span class="o">,</span> <span class="nc">.typing-indicator</span> <span class="p">{</span>&#x000A;  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>&#x000A;  <span class="nl">float</span><span class="p">:</span> <span class="nb">right</span><span class="p">;</span>&#x000A;  <span class="nl">clear</span><span class="p">:</span> <span class="nb">both</span><span class="p">;</span>&#x000A;  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.5em</span><span class="p">;</span>&#x000A;  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">1.0625em</span><span class="p">;</span>&#x000A;  <span class="nl">line-height</span><span class="p">:</span> <span class="m">1.3</span><span class="p">;</span>&#x000A;  <span class="nl">font-family</span><span class="p">:</span> <span class="n">Helvetica</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="nc">.message-bubble.reply</span><span class="o">,</span> <span class="nc">.typing-indicator</span> <span class="p">{</span>&#x000A;  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#e5e5ea</span><span class="p">;</span>&#x000A;  <span class="nl">color</span><span class="p">:</span> <span class="m">#020202</span><span class="p">;</span>&#x000A;  <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="nc">.message-bubble</span> <span class="p">{</span>&#x000A;  <span class="nl">padding</span><span class="p">:</span> <span class="m">0.5em</span> <span class="m">0.75em</span><span class="p">;</span>&#x000A;  <span class="nl">max-width</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">100</span><span class="err">%</span> <span class="n">-</span> <span class="m">7em</span><span class="p">);</span>&#x000A;  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#1983fa</span><span class="p">;</span>&#x000A;  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble.reply</span> <span class="nc">.message-bubble-whale-tail</span> <span class="p">{</span>&#x000A;  <span class="nl">right</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>&#x000A;  <span class="nl">left</span><span class="p">:</span> <span class="m">-0.5184em</span><span class="p">;</span>&#x000A;  <span class="nl">transform</span><span class="p">:</span> <span class="n">scaleX</span><span class="p">(</span><span class="m">-1</span><span class="p">);</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble.reply</span> <span class="nc">.message-bubble-whale-tail</span> <span class="nt">path</span> <span class="p">{</span>&#x000A;  <span class="py">fill</span><span class="p">:</span> <span class="m">#e5e5ea</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble.no-tail</span> <span class="nc">.message-bubble-whale-tail</span> <span class="p">{</span>&#x000A;  <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble.reply</span> <span class="o">+</span> <span class="nc">.message-bubble.reply</span> <span class="p">{</span>&#x000A;  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.reply</span><span class="o">)</span> <span class="o">+</span> <span class="nc">.message-bubble</span><span class="nd">:not</span><span class="o">(</span><span class="nc">.reply</span><span class="o">)</span> <span class="p">{</span>&#x000A;  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0.25em</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble.return</span> <span class="p">{</span>&#x000A;  <span class="nl">transition</span><span class="p">:</span> <span class="n">transform</span> <span class="m">0.4s</span> <span class="n">ease</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble.return</span> <span class="nc">.message-bubble-timestamp</span> <span class="p">{</span>&#x000A;  <span class="nl">transition</span><span class="p">:</span> <span class="n">opacity</span> <span class="m">0.4s</span> <span class="n">ease</span><span class="p">,</span> <span class="n">transform</span> <span class="m">0.4s</span> <span class="n">ease</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble.temp-hide</span> <span class="p">{</span>&#x000A;  <span class="nl">visibility</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>&#x000A;  <span class="nl">transition</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble</span> <span class="nc">.message-bubble-inner</span> <span class="p">{</span>&#x000A;  <span class="nl">max-width</span><span class="p">:</span> <span class="m">18em</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble</span> <span class="nt">p</span><span class="nd">:first-of-type</span> <span class="p">{</span>&#x000A;  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble</span> <span class="nt">p</span><span class="nd">:last-of-type</span> <span class="p">{</span>&#x000A;  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble</span> <span class="nc">.message-bubble-whale-tail</span> <span class="p">{</span>&#x000A;  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>&#x000A;  <span class="nl">right</span><span class="p">:</span> <span class="m">-0.5616em</span><span class="p">;</span>&#x000A;  <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>&#x000A;  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span> <span class="cp">!important</span><span class="p">;</span>&#x000A;  <span class="nl">width</span><span class="p">:</span> <span class="m">1.08em</span><span class="p">;</span>&#x000A;  <span class="nl">height</span><span class="p">:</span> <span class="m">0.90309em</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble</span> <span class="nc">.message-bubble-whale-tail</span> <span class="nt">path</span> <span class="p">{</span>&#x000A;  <span class="py">fill</span><span class="p">:</span> <span class="m">#1983fa</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble</span> <span class="nc">.message-bubble-timestamp</span> <span class="p">{</span>&#x000A;  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>&#x000A;  <span class="nl">left</span><span class="p">:</span> <span class="m">100</span><span class="err">%</span><span class="p">;</span>&#x000A;  <span class="nl">top</span><span class="p">:</span> <span class="m">50</span><span class="err">%</span><span class="p">;</span>&#x000A;  <span class="nl">transform</span><span class="p">:</span> <span class="n">translateY</span><span class="p">(</span><span class="m">-50</span><span class="err">%</span><span class="p">);</span>&#x000A;  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>&#x000A;  <span class="nl">width</span><span class="p">:</span> <span class="m">7em</span><span class="p">;</span>&#x000A;  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>&#x000A;  <span class="nl">color</span><span class="p">:</span> <span class="m">#bebebe</span><span class="p">;</span>&#x000A;  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.8em</span><span class="p">;</span>&#x000A;  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="nc">.message-bubble-heading</span> <span class="p">{</span>&#x000A;  <span class="nl">padding</span><span class="p">:</span> <span class="m">2em</span> <span class="m">0</span> <span class="m">0</span><span class="p">;</span>&#x000A;  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>&#x000A;  <span class="nl">clear</span><span class="p">:</span> <span class="nb">both</span><span class="p">;</span>&#x000A;  <span class="nl">font-family</span><span class="p">:</span> <span class="n">Helvetica</span><span class="p">;</span>&#x000A;  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>&#x000A;  <span class="nl">font-size</span><span class="p">:</span> <span class="m">0.8em</span><span class="p">;</span>&#x000A;  <span class="nl">color</span><span class="p">:</span> <span class="m">#bebebe</span><span class="p">;</span>&#x000A;  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.message-bubble-heading</span> <span class="nc">.message-bubble-date</span> <span class="p">{</span>&#x000A;  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">bold</span><span class="p">;</span>&#x000A;  <span class="nl">color</span><span class="p">:</span> <span class="m">#a5a5a5</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="nc">.typing-indicator</span> <span class="p">{</span>&#x000A;  <span class="nl">padding</span><span class="p">:</span> <span class="m">0.8em</span> <span class="m">1.6em</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.typing-indicator</span><span class="nd">:before</span><span class="o">,</span> <span class="nc">.typing-indicator</span><span class="nd">:after</span> <span class="p">{</span>&#x000A;  <span class="nl">content</span><span class="p">:</span> <span class="s2">''</span><span class="p">;</span>&#x000A;  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>&#x000A;  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>&#x000A;  <span class="nl">height</span><span class="p">:</span> <span class="m">0.8em</span><span class="p">;</span>&#x000A;  <span class="nl">width</span><span class="p">:</span> <span class="m">0.8em</span><span class="p">;</span>&#x000A;  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">0.8em</span><span class="p">;</span>&#x000A;  <span class="nl">left</span><span class="p">:</span> <span class="m">-0.15em</span><span class="p">;</span>&#x000A;  <span class="nl">bottom</span><span class="p">:</span> <span class="m">-0.15em</span><span class="p">;</span>&#x000A;  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#e5e5ea</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;<span class="nc">.typing-indicator</span><span class="nd">:after</span> <span class="p">{</span>&#x000A;  <span class="nl">height</span><span class="p">:</span> <span class="m">0.45em</span><span class="p">;</span>&#x000A;  <span class="nl">width</span><span class="p">:</span> <span class="m">0.45em</span><span class="p">;</span>&#x000A;  <span class="nl">left</span><span class="p">:</span> <span class="m">-0.5em</span><span class="p">;</span>&#x000A;  <span class="nl">bottom</span><span class="p">:</span> <span class="m">-0.5em</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;</code></pre>
          </div>
        </div>
        <div class='source-code-language'>
          <h3>JavaScript</h3>
          <div class='source-code-js'>
            <pre><code class="highlight"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;  <span class="kd">var</span> <span class="nx">$w</span><span class="p">,</span> <span class="nx">DAYS_IN_MS</span><span class="p">,</span> <span class="nx">MessageBubble</span><span class="p">,</span> <span class="nx">MessageBubbleController</span><span class="p">,</span> <span class="nx">Timestamper</span><span class="p">;</span>&#x000A;&#x000A;  <span class="nx">DAYS_IN_MS</span> <span class="o">=</span> <span class="mi">86400000</span><span class="p">;</span>&#x000A;&#x000A;  <span class="nx">$w</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>&#x000A;&#x000A;  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">transitionEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s2">"transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>&#x000A;  <span class="p">};</span>&#x000A;&#x000A;  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">animationEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s2">"webkitAnimationEnd oanimationend msAnimationEnd animationend"</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>&#x000A;  <span class="p">};</span>&#x000A;&#x000A;  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">verticalSpaceAvail</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">$w</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">();</span>&#x000A;  <span class="p">};</span>&#x000A;&#x000A;  <span class="nx">MessageBubble</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="kd">function</span> <span class="nx">MessageBubble</span><span class="p">()</span> <span class="p">{}</span>&#x000A;&#x000A;    <span class="k">return</span> <span class="nx">MessageBubble</span><span class="p">;</span>&#x000A;&#x000A;  <span class="p">})();</span>&#x000A;&#x000A;  <span class="nx">MessageBubble</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="s2">"&lt;div class='message-bubble'&gt; &lt;div class='message-bubble-inner'&gt; MESSAGE &lt;svg style='display: none' class='message-bubble-whale-tail' width='116px' height='119px' viewBox='0 0 116 119' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' enable-background='new 0 0 116.42 97.35' xml:space='preserve'&gt; &lt;path fill='#A0A0A0' d='M67.39,79.03 C84.24,104.95 116.42,115.32 116.42,115.32 C116.42,115.32 73.88,124.39 46.66,115.32 C19.44,106.24 0,79.03 0,79.03 L0,-0.227279902 L51.8400002,-0.227279902 L51.84,22 C51.84,22 50.54,53.1 67.39,79.03 Z'&gt;&lt;/path&gt; &lt;/svg&gt; &lt;/div&gt; &lt;/div&gt;"</span><span class="p">;</span>&#x000A;&#x000A;  <span class="nx">MessageBubbleController</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="kd">function</span> <span class="nx">MessageBubbleController</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$messageBubbleContainer</span><span class="p">;</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">settings</span> <span class="o">=</span> <span class="p">{};</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="nx">$messageBubbleContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">".message-bubble-container"</span><span class="p">);</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">$messageBubbleContainer</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">$messageBubbleContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"body"</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">container</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">?</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">container</span> <span class="p">:</span> <span class="nx">$messageBubbleContainer</span><span class="p">;</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">".message-bubble"</span><span class="p">);</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">_messageDateSectionHTML</span> <span class="o">=</span> <span class="s2">"&lt;section class='message-bubble-date-section' /&gt;"</span><span class="p">;</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">_timestampKey</span> <span class="o">=</span> <span class="s2">"message-timestamp"</span><span class="p">;</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">_timestamper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Timestamper</span><span class="p">;</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">automateDateSections</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">automateDateSections</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">?</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">automateDateSections</span> <span class="p">:</span> <span class="kc">true</span><span class="p">;</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">dateSectionCutoff</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">dateSectionCutoff</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">?</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">dateSectionCutoff</span> <span class="p">:</span> <span class="s2">"unique-day"</span><span class="p">;</span>&#x000A;    <span class="p">}</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setBackgroundColor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="nx">sel</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSubsetOfMessages</span><span class="p">(</span><span class="nx">sel</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="kd">var</span> <span class="nx">$this</span><span class="p">;</span>&#x000A;        <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;        <span class="nx">$this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>&#x000A;        <span class="k">return</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">".message-bubble-whale-tail path"</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>&#x000A;      <span class="p">});</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setTextColor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="nx">sel</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSubsetOfMessages</span><span class="p">(</span><span class="nx">sel</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">"color"</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>&#x000A;      <span class="p">});</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">newMessageBubble</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$afterElement</span><span class="p">,</span> <span class="nx">$beforeElement</span><span class="p">,</span> <span class="nx">$container</span><span class="p">,</span> <span class="nx">$insertionPoint</span><span class="p">,</span> <span class="nx">$lastDateSection</span><span class="p">,</span> <span class="nx">$lastMsg</span><span class="p">,</span> <span class="nx">$message</span><span class="p">,</span> <span class="nx">$relevantContainerChild</span><span class="p">,</span> <span class="nx">$replyMsg</span><span class="p">,</span> <span class="nx">curTSinDays</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">lastTSinDays</span><span class="p">,</span> <span class="nx">time</span><span class="p">;</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>&#x000A;        <span class="na">after</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">append</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>&#x000A;        <span class="na">container</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">artificialDate</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">timestamp</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>&#x000A;        <span class="na">tail</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>&#x000A;        <span class="na">inReplyTo</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">reply</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;        <span class="na">animate</span><span class="p">:</span> <span class="kc">null</span>&#x000A;      <span class="p">};</span>&#x000A;      <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>&#x000A;      <span class="nx">$message</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">MessageBubble</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">"MESSAGE"</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"temp-hide"</span><span class="p">);</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">animate</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">$message</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">"visibility"</span><span class="p">,</span> <span class="s2">"none"</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">append</span> <span class="k">instanceof</span> <span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">append</span><span class="p">)</span> <span class="o">===</span> <span class="s2">"[object String]"</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">options</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">append</span><span class="p">);</span>&#x000A;        <span class="nx">options</span><span class="p">.</span><span class="nx">append</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">time</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">artificialDate</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">?</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">artificialDate</span><span class="p">)</span> <span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>&#x000A;        <span class="nx">$message</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"data-"</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_timestampKey</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nx">getTime</span><span class="p">());</span>&#x000A;        <span class="k">this</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">tail</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">$message</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"no-tail"</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">$message</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"reply"</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">((</span><span class="nx">options</span><span class="p">.</span><span class="nx">inReplyTo</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">$replyMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">inReplyTo</span><span class="p">)).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">$message</span><span class="p">[</span><span class="nx">$replyMsg</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">"reply"</span><span class="p">)</span> <span class="p">?</span> <span class="s2">"removeClass"</span> <span class="p">:</span> <span class="s2">"addClass"</span><span class="p">](</span><span class="s2">"reply"</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">after</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">if</span> <span class="p">((</span><span class="nx">$afterElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">after</span><span class="p">)).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>&#x000A;          <span class="nx">$message</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">$afterElement</span><span class="p">);</span>&#x000A;        <span class="p">}</span>&#x000A;      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">before</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">if</span> <span class="p">((</span><span class="nx">$beforeElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">before</span><span class="p">)).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>&#x000A;          <span class="nx">$message</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">$beforeElement</span><span class="p">);</span>&#x000A;        <span class="p">}</span>&#x000A;      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">automateDateSections</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">$lastMsg</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">last</span><span class="p">();</span>&#x000A;        <span class="nx">curTSinDays</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">$message</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timestampKey</span><span class="p">)).</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="nx">DAYS_IN_MS</span><span class="p">);</span>&#x000A;        <span class="nx">lastTSinDays</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">$lastMsg</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timestampKey</span><span class="p">)).</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="nx">DAYS_IN_MS</span><span class="p">);</span>&#x000A;        <span class="k">if</span> <span class="p">(</span><span class="nx">curTSinDays</span> <span class="o">-</span> <span class="nx">lastTSinDays</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>&#x000A;          <span class="nx">$insertionPoint</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$lastDateSection</span> <span class="o">=</span> <span class="nx">$lastMsg</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">".message-bubble-date-section"</span><span class="p">)).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">$lastDateSection</span> <span class="p">:</span> <span class="nx">$lastMsg</span><span class="p">;</span>&#x000A;          <span class="k">this</span><span class="p">.</span><span class="nx">_makeQuickDateSection</span><span class="p">(</span><span class="nx">$message</span><span class="p">).</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">$insertionPoint</span><span class="p">);</span>&#x000A;        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>&#x000A;          <span class="nx">$message</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">$lastMsg</span><span class="p">);</span>&#x000A;        <span class="p">}</span>&#x000A;      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>&#x000A;        <span class="nx">$container</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">container</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">?</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>&#x000A;        <span class="nx">$relevantContainerChild</span> <span class="o">=</span> <span class="nx">$container</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">append</span> <span class="p">?</span> <span class="s2">":last-child"</span> <span class="p">:</span> <span class="s2">":first-child"</span><span class="p">);</span>&#x000A;        <span class="k">if</span> <span class="p">(</span><span class="nx">$relevantContainerChild</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">"message-bubble-date-section"</span><span class="p">))</span> <span class="p">{</span>&#x000A;          <span class="nx">$container</span> <span class="o">=</span> <span class="nx">$relevantContainerChild</span><span class="p">;</span>&#x000A;        <span class="p">}</span>&#x000A;        <span class="nx">$message</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">append</span> <span class="p">?</span> <span class="s2">"appendTo"</span> <span class="p">:</span> <span class="s2">"prependTo"</span><span class="p">](</span><span class="nx">$container</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">animate</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">this</span><span class="p">.</span><span class="nx">_resolveAddAnimation</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span>&#x000A;      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>&#x000A;        <span class="nx">$message</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"temp-hide"</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">_update</span><span class="p">();</span>&#x000A;      <span class="k">return</span> <span class="nx">$message</span><span class="p">;</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_resolveAddAnimation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$msg</span><span class="p">,</span> <span class="nx">animate</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$container</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">endTransition</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">startTranslate</span><span class="p">;</span>&#x000A;      <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>&#x000A;        <span class="na">props</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">duration</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>&#x000A;        <span class="na">delay</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>&#x000A;        <span class="na">timingFunction</span><span class="p">:</span> <span class="s2">"ease"</span><span class="p">,</span>&#x000A;        <span class="na">from</span><span class="p">:</span> <span class="s2">"right"</span><span class="p">,</span>&#x000A;        <span class="na">callback</span><span class="p">:</span> <span class="kc">null</span>&#x000A;      <span class="p">};</span>&#x000A;      <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">animate</span><span class="p">);</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">timingFunction</span> <span class="o">===</span> <span class="s2">"spring"</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">options</span><span class="p">.</span><span class="nx">timingFunction</span> <span class="o">=</span> <span class="s2">"cubic-bezier(0.37, 1.65, 0.305, 0.855)"</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">([</span><span class="s2">"right"</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">,</span> <span class="s2">"top"</span><span class="p">,</span> <span class="s2">"bottom"</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">from</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">$container</span> <span class="o">=</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>&#x000A;        <span class="nx">endTransition</span> <span class="o">=</span> <span class="s2">"transform "</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">duration</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">?</span> <span class="s2">"s"</span> <span class="p">:</span> <span class="s2">"ms"</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">timingFunction</span><span class="p">;</span>&#x000A;        <span class="nx">startTranslate</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;          <span class="k">switch</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">from</span><span class="p">)</span> <span class="p">{</span>&#x000A;            <span class="k">case</span> <span class="s2">"right"</span><span class="err">:</span>&#x000A;              <span class="k">return</span> <span class="nx">$container</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">()</span> <span class="o">+</span> <span class="nx">$container</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span><span class="p">;</span>&#x000A;            <span class="k">case</span> <span class="s2">"left"</span><span class="err">:</span>&#x000A;              <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="nx">$msg</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">()</span> <span class="o">+</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">$container</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span><span class="p">);</span>&#x000A;            <span class="k">case</span> <span class="s2">"top"</span><span class="err">:</span>&#x000A;              <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="nx">$msg</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span> <span class="o">+</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span> <span class="nx">$container</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">));</span>&#x000A;            <span class="k">case</span> <span class="s2">"bottom"</span><span class="err">:</span>&#x000A;              <span class="nx">offset</span> <span class="o">=</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">offset</span><span class="p">();</span>&#x000A;              <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">$w</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="nx">offset</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">$w</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()),</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span> <span class="o">+</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span> <span class="nx">$container</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">));</span>&#x000A;          <span class="p">}</span>&#x000A;        <span class="p">})();</span>&#x000A;        <span class="nx">startTranslate</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;          <span class="k">switch</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">from</span><span class="p">)</span> <span class="p">{</span>&#x000A;            <span class="k">case</span> <span class="s2">"right"</span><span class="err">:</span>&#x000A;            <span class="k">case</span> <span class="s2">"left"</span><span class="err">:</span>&#x000A;              <span class="k">return</span> <span class="s2">"translate("</span> <span class="o">+</span> <span class="nx">startTranslate</span> <span class="o">+</span> <span class="s2">"px, 0)"</span><span class="p">;</span>&#x000A;            <span class="k">case</span> <span class="s2">"top"</span><span class="err">:</span>&#x000A;            <span class="k">case</span> <span class="s2">"bottom"</span><span class="err">:</span>&#x000A;              <span class="k">return</span> <span class="s2">"translate(0, "</span> <span class="o">+</span> <span class="nx">startTranslate</span> <span class="o">+</span> <span class="s2">"px)"</span><span class="p">;</span>&#x000A;          <span class="p">}</span>&#x000A;        <span class="p">})();</span>&#x000A;        <span class="nx">$msg</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span> <span class="nx">startTranslate</span><span class="p">);</span>&#x000A;        <span class="nx">$msg</span><span class="p">.</span><span class="nx">transitionEnd</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;          <span class="k">return</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>&#x000A;            <span class="s2">"transition"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>&#x000A;            <span class="s2">"-webkit-transition"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>&#x000A;            <span class="s2">"transform"</span><span class="p">:</span> <span class="s2">""</span>&#x000A;          <span class="p">});</span>&#x000A;        <span class="p">});</span>&#x000A;        <span class="k">return</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;          <span class="k">return</span> <span class="nx">$msg</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"temp-hide"</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>&#x000A;            <span class="s2">"transition"</span><span class="p">:</span> <span class="nx">endTransition</span><span class="p">,</span>&#x000A;            <span class="s2">"-webkit-transition"</span><span class="p">:</span> <span class="s2">"-webkit-"</span> <span class="o">+</span> <span class="nx">endTransition</span><span class="p">,</span>&#x000A;            <span class="s2">"transform"</span><span class="p">:</span> <span class="s2">"translate(0, 0)"</span>&#x000A;          <span class="p">});</span>&#x000A;        <span class="p">},</span> <span class="mi">5</span><span class="p">);</span>&#x000A;      <span class="p">}</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">newMessageBubble</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">makeDateSection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$container</span><span class="p">,</span> <span class="nx">$messageSet</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">headingText</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>&#x000A;        <span class="na">startMessage</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">endMessage</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">messageCount</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">sectionHeadingDate</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>&#x000A;        <span class="na">sectionHeadingTime</span><span class="p">:</span> <span class="kc">null</span>&#x000A;      <span class="p">};</span>&#x000A;      <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>&#x000A;      <span class="nx">$messages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">;</span>&#x000A;      <span class="nx">options</span><span class="p">.</span><span class="nx">startMessage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_convertPossibleSelectorToIndexNumber</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">startMessage</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_convertPossibleSelectorToIndexNumber</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>&#x000A;      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">messageCount</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">startMessage</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">messageCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">((</span><span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">_ref</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_ref</span> <span class="o">&gt;</span> <span class="nx">$messages</span><span class="p">.</span><span class="nx">length</span><span class="p">))</span> <span class="p">{</span>&#x000A;        <span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span> <span class="o">=</span> <span class="nx">$messages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="nx">$messageSet</span> <span class="o">=</span> <span class="nx">$messages</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">startMessage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">endMessage</span><span class="p">);</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">_destroyOverlappingSections</span><span class="p">(</span><span class="nx">$messageSet</span><span class="p">);</span>&#x000A;      <span class="nx">$messageSet</span><span class="p">.</span><span class="nx">wrapAll</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_messageDateSectionHTML</span><span class="p">);</span>&#x000A;      <span class="nx">$container</span> <span class="o">=</span> <span class="nx">$messageSet</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>&#x000A;      <span class="nx">headingText</span> <span class="o">=</span> <span class="s2">"&lt;h3 class='message-bubble-heading'&gt; &lt;span class='message-bubble-date'&gt; "</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">sectionHeadingDate</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_weekdayString</span><span class="p">(</span><span class="nx">$messageSet</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timestampKey</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">" &lt;/span&gt; "</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">sectionHeadingTime</span> <span class="p">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">sectionHeadingTime</span> <span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">sectionHeadingDate</span> <span class="o">==</span> <span class="kc">null</span> <span class="p">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">_formatDateString</span><span class="p">(</span><span class="nx">$messageSet</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timestampKey</span><span class="p">))</span> <span class="p">:</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" &lt;/h3&gt;"</span><span class="p">;</span>&#x000A;      <span class="nx">$</span><span class="p">(</span><span class="nx">headingText</span><span class="p">).</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$container</span><span class="p">);</span>&#x000A;      <span class="k">return</span> <span class="nx">$container</span><span class="p">;</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_makeQuickDateSection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$messages</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$dateSection</span><span class="p">,</span> <span class="nx">date</span><span class="p">;</span>&#x000A;      <span class="nx">$dateSection</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_messageDateSectionHTML</span><span class="p">);</span>&#x000A;      <span class="nx">date</span> <span class="o">=</span> <span class="nx">$messages</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timestampKey</span><span class="p">);</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">_destroyOverlappingSections</span><span class="p">(</span><span class="nx">$messages</span><span class="p">);</span>&#x000A;      <span class="nx">$messages</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$dateSection</span><span class="p">);</span>&#x000A;      <span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;h3 class='message-bubble-heading'&gt; &lt;span class='message-bubble-date'&gt; "</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_weekdayString</span><span class="p">(</span><span class="nx">date</span><span class="p">))</span> <span class="o">+</span> <span class="s2">" &lt;/span&gt; "</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_formatDateString</span><span class="p">(</span><span class="nx">date</span><span class="p">))</span> <span class="o">+</span> <span class="s2">" &lt;/h3&gt;"</span><span class="p">).</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$dateSection</span><span class="p">);</span>&#x000A;      <span class="k">return</span> <span class="nx">$dateSection</span><span class="p">;</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_destroyOverlappingSections</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$messages</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="nx">$messages</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="kd">var</span> <span class="nx">$parent</span><span class="p">,</span> <span class="nx">$this</span><span class="p">;</span>&#x000A;        <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;        <span class="nx">$parent</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>&#x000A;        <span class="k">if</span> <span class="p">(</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">"message-bubble-date-section"</span><span class="p">))</span> <span class="p">{</span>&#x000A;          <span class="nx">$parent</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">".message-bubble-heading"</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>&#x000A;          <span class="k">return</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">unwrap</span><span class="p">();</span>&#x000A;        <span class="p">}</span>&#x000A;      <span class="p">});</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_convertPossibleSelectorToIndexNumber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">shouldBeNum</span><span class="p">,</span> <span class="nx">$containingSet</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">shouldBeNum</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">shouldBeNum</span> <span class="o">!==</span> <span class="s2">"number"</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">shouldBeNum</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">shouldBeNum</span><span class="p">);</span>&#x000A;        <span class="nx">shouldBeNum</span> <span class="o">=</span> <span class="nx">$containingSet</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="nx">shouldBeNum</span><span class="p">);</span>&#x000A;        <span class="k">if</span> <span class="p">(</span><span class="nx">shouldBeNum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>&#x000A;          <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>&#x000A;        <span class="p">}</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">return</span> <span class="nx">shouldBeNum</span><span class="p">;</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeMessageBubbles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$removalsMade</span><span class="p">,</span> <span class="nx">that</span><span class="p">;</span>&#x000A;      <span class="nx">$removalsMade</span> <span class="o">=</span> <span class="nx">$</span><span class="p">();</span>&#x000A;      <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">getSubsetOfMessages</span><span class="p">(</span><span class="nx">sel</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="kd">var</span> <span class="nx">$this</span><span class="p">;</span>&#x000A;        <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;        <span class="nx">that</span><span class="p">.</span><span class="nx">_checkForSectionRemovalAndRemove</span><span class="p">(</span><span class="nx">$this</span><span class="p">);</span>&#x000A;        <span class="k">return</span> <span class="nx">$removalsMade</span> <span class="o">=</span> <span class="nx">$removalsMade</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$this</span><span class="p">);</span>&#x000A;      <span class="p">});</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">$removalsMade</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>&#x000A;        <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;          <span class="kd">var</span> <span class="nx">$this</span><span class="p">;</span>&#x000A;          <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;          <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">match</span><span class="p">(</span><span class="nx">sel</span><span class="p">))</span> <span class="p">{</span>&#x000A;            <span class="nx">that</span><span class="p">.</span><span class="nx">_checkForSectionRemovalAndRemove</span><span class="p">(</span><span class="nx">$this</span><span class="p">);</span>&#x000A;            <span class="k">return</span> <span class="nx">$removalsMade</span> <span class="o">=</span> <span class="nx">$removalsMade</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$this</span><span class="p">);</span>&#x000A;          <span class="p">}</span>&#x000A;        <span class="p">});</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">this</span><span class="p">.</span><span class="nx">_update</span><span class="p">();</span>&#x000A;      <span class="k">return</span> <span class="nx">$removalsMade</span><span class="p">;</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">removeMessageBubbles</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="s2">"delete"</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">removeMessageBubbles</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_checkForSectionRemovalAndRemove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$elem</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">$elem</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">".message-bubble-date-section"</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">$elem</span><span class="p">.</span><span class="nx">siblings</span><span class="p">(</span><span class="s2">".message-bubble"</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="nx">$elem</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>&#x000A;      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="nx">$elem</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>&#x000A;      <span class="p">}</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$matching</span><span class="p">,</span> <span class="nx">that</span><span class="p">;</span>&#x000A;      <span class="nx">$matching</span> <span class="o">=</span> <span class="nx">sel</span> <span class="k">instanceof</span> <span class="nx">jQuery</span> <span class="p">?</span> <span class="nx">sel</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSubsetOfMessages</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>&#x000A;      <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>&#x000A;      <span class="k">return</span> <span class="nx">$matching</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="kd">var</span> <span class="nx">$this</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">;</span>&#x000A;        <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;        <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">_timestampKey</span><span class="p">);</span>&#x000A;        <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">);</span>&#x000A;        <span class="k">if</span> <span class="p">(</span><span class="nx">timestamp</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="s2">""</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/Invalid/gi</span><span class="p">)))</span> <span class="p">{</span>&#x000A;          <span class="k">return</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"&lt;span class='message-bubble-timestamp'&gt;"</span> <span class="o">+</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">_formatDateString</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"&lt;/span&gt;"</span><span class="p">);</span>&#x000A;        <span class="p">}</span>&#x000A;      <span class="p">});</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_formatDateString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_timestamper</span><span class="p">.</span><span class="nx">formatDateString</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_weekdayString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_timestamper</span><span class="p">.</span><span class="nx">weekdayString</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getSubsetOfMessages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sel</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">sel</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">is</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>&#x000A;      <span class="p">});</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">".message-bubble"</span><span class="p">);</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">MessageBubbleController</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">typing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">$typingIndicators</span><span class="p">;</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="nx">state</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="nx">$typingIndicators</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">".typing-indicator"</span><span class="p">);</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">if</span> <span class="p">(</span><span class="nx">$typingIndicators</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>&#x000A;          <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;div class='typing-indicator'&gt;&lt;div class='typing-indicator-dot' /&gt;&lt;/div&gt;"</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">);</span>&#x000A;        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>&#x000A;          <span class="k">return</span> <span class="nx">$typingIndicators</span><span class="p">;</span>&#x000A;        <span class="p">}</span>&#x000A;      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="nx">$typingIndicators</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>&#x000A;      <span class="p">}</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="k">return</span> <span class="nx">MessageBubbleController</span><span class="p">;</span>&#x000A;&#x000A;  <span class="p">})();</span>&#x000A;&#x000A;  <span class="nx">Timestamper</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="kd">function</span> <span class="nx">Timestamper</span><span class="p">()</span> <span class="p">{}</span>&#x000A;&#x000A;    <span class="nx">Timestamper</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">formatDateString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">adjHours</span><span class="p">,</span> <span class="nx">hours</span><span class="p">,</span> <span class="nx">mins</span><span class="p">,</span> <span class="nx">_ref</span><span class="p">;</span>&#x000A;      <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>&#x000A;      <span class="nx">_ref</span> <span class="o">=</span> <span class="p">[</span><span class="nx">date</span><span class="p">.</span><span class="nx">getHours</span><span class="p">(),</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()],</span> <span class="nx">hours</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">mins</span> <span class="o">=</span> <span class="nx">_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>&#x000A;      <span class="nx">adjHours</span> <span class="o">=</span> <span class="nx">hours</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">!==</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">hours</span> <span class="o">%</span> <span class="mi">12</span> <span class="p">:</span> <span class="mi">12</span><span class="p">;</span>&#x000A;      <span class="k">return</span> <span class="s2">""</span> <span class="o">+</span> <span class="nx">adjHours</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="p">(</span><span class="nx">mins</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="s2">""</span><span class="p">)</span> <span class="o">+</span> <span class="nx">mins</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="p">(</span><span class="nx">hours</span> <span class="o">&lt;</span> <span class="mi">12</span> <span class="p">?</span> <span class="s2">"AM"</span> <span class="p">:</span> <span class="s2">"PM"</span><span class="p">);</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="nx">Timestamper</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">weekdayString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>&#x000A;      <span class="kd">var</span> <span class="nx">today</span><span class="p">;</span>&#x000A;      <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>&#x000A;      <span class="nx">today</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>&#x000A;      <span class="k">if</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getYear</span><span class="p">()</span> <span class="o">===</span> <span class="nx">today</span><span class="p">.</span><span class="nx">getYear</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">===</span> <span class="nx">today</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()</span> <span class="o">===</span> <span class="nx">today</span><span class="p">.</span><span class="nx">getDay</span><span class="p">())</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="s2">"Today"</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;      <span class="k">switch</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getDay</span><span class="p">())</span> <span class="p">{</span>&#x000A;        <span class="k">case</span> <span class="mi">0</span><span class="err">:</span>&#x000A;          <span class="k">return</span> <span class="s2">"Sunday"</span><span class="p">;</span>&#x000A;        <span class="k">case</span> <span class="mi">1</span><span class="err">:</span>&#x000A;          <span class="k">return</span> <span class="s2">"Monday"</span><span class="p">;</span>&#x000A;        <span class="k">case</span> <span class="mi">2</span><span class="err">:</span>&#x000A;          <span class="k">return</span> <span class="s2">"Tuesday"</span><span class="p">;</span>&#x000A;        <span class="k">case</span> <span class="mi">3</span><span class="err">:</span>&#x000A;          <span class="k">return</span> <span class="s2">"Wednesday"</span><span class="p">;</span>&#x000A;        <span class="k">case</span> <span class="mi">4</span><span class="err">:</span>&#x000A;          <span class="k">return</span> <span class="s2">"Thursday"</span><span class="p">;</span>&#x000A;        <span class="k">case</span> <span class="mi">5</span><span class="err">:</span>&#x000A;          <span class="k">return</span> <span class="s2">"Friday"</span><span class="p">;</span>&#x000A;        <span class="nl">default</span><span class="p">:</span>&#x000A;          <span class="k">return</span> <span class="s2">"Saturday"</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;    <span class="p">};</span>&#x000A;&#x000A;    <span class="k">return</span> <span class="nx">Timestamper</span><span class="p">;</span>&#x000A;&#x000A;  <span class="p">})();</span>&#x000A;&#x000A;  <span class="nb">window</span><span class="p">.</span><span class="nx">MessageBubbleController</span> <span class="o">=</span> <span class="nx">MessageBubbleController</span><span class="p">;</span>&#x000A;&#x000A;<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;</code></pre>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
